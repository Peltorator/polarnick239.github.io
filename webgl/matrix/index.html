<!DOCTYPE html>
<html style="height: 100%">
<head lang="en">
    <meta charset="UTF-8">
    <title>Matrix digital rain</title>
</head>

<script id="matrix_vshader" type="x-shader/x-vertex">
    attribute vec2 aPosition;

    varying vec2 vPosition;

    void main() {
        vPosition = (aPosition + 1.0) / 2.0;
        gl_Position = vec4(aPosition, 0.0, 1.0);
    }
</script>

<script id="matrix_fshader" type="x-shader/x-fragment">
    #line 20
    precision mediump float;

    const vec2 fontsTextureSize = vec2(2048.0, 1024.0);
    const vec2 fontsCount = vec2(16.0, 5.0);
    const vec2 fontsSize = vec2(60.0, 88.0);
    const vec2 fontsStep = vec2(5.0, 24.0);

    uniform sampler2D uFonts;

    varying vec2 vPosition;

    vec4 sampleFont(vec2 ij, vec2 xy) {
        xy.x = 1.0 - xy.x;
        vec2 fontCorner = (fontsSize + fontsStep) * ij / fontsTextureSize;
        vec2 uv = fontCorner + xy * fontsSize / fontsTextureSize;
        return texture2D(uFonts, uv);
    }

    void main() {
        vec2 position = vPosition;
        position.y = 1.0 - position.y;

        vec2 ij = floor(position * fontsCount);
        vec2 xy = fract(position * fontsCount);

        vec3 color1 = sampleFont(ij, xy).rgb;
        vec3 color2 = vec3(xy.x, xy.y, 0.0);
        gl_FragColor = vec4((color1 + 2.0*color2) / 2.0, 1.0);
    }
</script>

<script src="build/main.js"></script>
<script src="js/glMatrix.js"></script>
<script>
    function start() {
        var canvas = document.getElementById('webgl_canvas');
        matrix.start(canvas,
                document.getElementById('matrix_vshader').text,
                document.getElementById('matrix_fshader').text,
                'fonts.png');
    }
</script>

<body onload="start()" style="margin: 0; padding: 0; height: 100%">
    <canvas id="webgl_canvas" style="width: 100%; height: 100%; display:block;"></canvas>
</body>
</html>